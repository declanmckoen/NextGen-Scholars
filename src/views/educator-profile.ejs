<%- include("partials/header"); %>

<div class="profile-container">
  <form class="profile-form">
    <h2 class="form-title">Edit Your Personal Information</h2>

    <label for="firstName">First Name</label>
    <input
      type="text"
      name="firstName"
      value="<%= user.educatorProfile.firstName %>" <!-- Pre-fill current value -->
      required
    />
    <div class="firstName error"></div>

    <label for="lastName">Last Name</label>
    <input
      type="text"
      name="lastName"
      value="<%= user.educatorProfile.lastName %>" <!-- Pre-fill current value -->
      required
    />
    <div class="lastName error"></div>

    <label for="school">Current School</label>
    <input
      type="text"
      name="school"
      value="<%= user.educatorProfile.school %>" <!-- Pre-fill current value -->
      required
    />
    <div class="school error"></div>

    <button class="submit-button">Save Changes</button>
  </form>
</div>

<script>
  const form = document.querySelector(".profile-form");

  form.addEventListener("submit", async (event) => {
    event.preventDefault();

    const firstName = form.firstName.value;
    const lastName = form.lastName.value;
    const school = form.school.value;
    const id = "<%= user._id %>";

    try {
      const res = await fetch(`/educator-profile/${id}/edit`, { // Update the backend route
        method: "PUT",
        body: JSON.stringify({ firstName, lastName, school }),
        headers: { "Content-Type": "application/json" }
      });

      const data = await res.json();
      if (data.error) {
        console.error(data.error);
      }
      if (data.success) {
        location.assign(`/educator-home/${id}`); // Redirect on success
      }
    } catch (err) {
      console.error(err);
    }
  });
</script>

<%- include("partials/footer"); %>
