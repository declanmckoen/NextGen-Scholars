<%- include("partials/header"); %>

<form>

  <h2>Please enter your personal information</h2>

  <label for="firstName">First Name</label>
  <input type="text" name="firstName" required />
  <div class="firstName error"></div>

  <label for="lastName">Last Name</label>
  <input type="text" name="lastName" required />
  <div class="lastName error"></div>

  <label for="birthDate">Birth Date</label>
  <input type="date" name="birthDate" required />
  <div class="birthDate error"></div>

  <label for="gender">Gender</label>
  <select name="gender" required>
    <option value="">--Select--</option>
    <option value="male">Male</option>
    <option value="female">Female</option>
    <option value="non-binary">Non-Binary</option>
    <option value="self-describe">Prefer to self-describe</option>
  </select>
  <div class="gender error"></div>

  <label for="race">Race</label>
  <select name="race" required>
    <option value="">--Select--</option>
    <option value="white">White</option>
    <option value="black">Black or African American</option>
    <option value="asian">Asian</option>
    <option value="native-american">Native American or Alaska Native</option>
    <option value="native-hawaiian">Native Hawaiian or Other Pacific Islander</option>
    <option value="hispanic">Hispanic or Latino</option>
    <option value="mixed">Two or More Races</option>
    <option value="other">Other</option>
    <option value="prefer-not-to-say">Prefer not to say</option>
  </select>
  <div class="race error"></div>

  <label for="gpa">Current Grade Point Average</label>
  <input type="text" name="gpa" required />
  <div class="gpa error"></div>

  <label for="school">Current High School</label>
  <input type="text" name="school" required />
  <div class="school error"></div>

  <button>Submit</button>

</form>


<script>

  const form = document.querySelector("form");

  form.addEventListener("submit", async (event) => {
    event.preventDefault();

    const firstName = form.firstName.value;
    const lastName = form.lastName.value;
    const birthDate = new Date(form.birthDate.value);
    const gender = form.gender.value;
    const race = form.race.value;
    const gpa = form.gpa.value;
    const school = form.school.value;
    const id = "<%= student._id %>";

    const currentDate = new Date();
    const age = currentDate.getFullYear() - birthDate.getFullYear();
    const ageNum = Number(age);

    const gpaNum = Number(gpa);

    try {
      const res = await fetch("/create-profile", {
        method: "POST",
        body: JSON.stringify({ firstName, lastName, ageNum, gpaNum, gender, race, school, id }),
        headers: { "Content-Type": "application/json" }
      });
      console.log("Made it");
      const data = await res.json();
      if (data.err) {
        console.log(data.err);
      }
      if (data.student) {
        location.assign("/");
      }
    }
    catch (err) {
      console.log(err);
    }
  });

</script>

<%- include("partials/footer"); %>
